<!DOCTYPE html>
<html>
  <head>
    <title>Simple Drawing App</title>
    <meta http-equiv="X-UA-Compatible" content="IE=10">
    <style>
      html { 
       -ms-touch-action: none;
       text-align: center; /* Center all contents of the page. */
      }
    </style>
  </head>
  <body id="bodyElement"> <!-- This ID is used in the following script block for feature detection. -->
    <div>
        <button id="imageDrop" onclick="document.getElementById('files').click()" title="Carregar arquivo ABC">Carregar</button>
        <input id="files" type="file" style="display: none;" />
        <button id="save">Salvar</button>
         <br> 
        <textarea rows="20" id="list" style="min-width: 400px;" >Veja esse exemplo: http://html5-demos.appspot.com/static/a.download.html</textarea>
    </div>
    <script>
        
        reader = new FileReader();
        reader.onload = readTextHandler;

	document.getElementById('files').addEventListener('change', handleFileSelect, false);

        function readTextHandler (progressEvent) {
            document.getElementById('list').innerHTML = progressEvent.target.result;
        }
  
        function requiredFeaturesAvailable() {
          // Check for the various File API support.
         if (window.File && window.FileReader && window.FileList && window.Blob) {
           // Great success! All the File APIs are supported.
           return true;
         } else {
           alert('The File APIs are not fully supported in this browser.');
           return false;
         }
       } // requiredFeaturesAvailable
       
       function supports_html5_storage()
        {
              try
              {
                return 'localStorage' in window && window['localStorage'] !== null;
              }
              catch (e)
              {
                return false;
              }
        }

        var Download = {
            click : function(node) {
                var ev = document.createEvent("MouseEvents");
                ev.initMouseEvent("click", true, false, self, 0, 0, 0, 0, 0, false, false, false, false, 0, null);
                return node.dispatchEvent(ev);
            },
            encode : function(data) {
                    return 'data:application/octet-stream;base64,' + btoa( data );
            },
            link : function(data, name){
                var a = document.createElement('a');
                a.downloadurl  = name || self.location.pathname.slice(self.location.pathname.lastIndexOf('/')+1);
                a.href = data || self.location.href;
                return a;
            },
            save : function(data, name){
                this.click(
                    this.link(
                        this.encode( data ),name )
                    );
                }            
            };

   
            function handleFileSelect(evt) {
              var files = evt.target.files; // FileList object

              for (var i = 0; i < files.length; i++) {

                reader.readAsText(files[i]);

              }
            }

      
            if ( !requiredFeaturesAvailable() ) {
              document.getElementById('bodyElement').innerHTML = "<h2>Required features are not supported by this browser.</h2><p>To use this application, upgrade your browser to the latest version.</p>";
            }
            else {


              window.addEventListener('load', init, false); // Safety first.

              function init() {
                document.getElementById('save').addEventListener('click', saveCanvas, false);

                function saveCanvas() {
                    var conteudo = document.getElementById('list').value;
                    
                    //testa html storage:
                    if( supports_html5_storage() === true )
                    {
                       localStorage.setItem("myItem", conteudo);
                       var myDataString = localStorage.getItem("myItem");
                       alert(myDataString);

                    }      
                    
                    // faz download via arquivo
                    Download.save( conteudo, 'my_file.txt');    
                    
                  
                } // saveCanvas
              } // init
            } // else
      
    </script>
  </body>
</html>
