<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>Mapa para Acordeons Diatônicos</title>
    <meta name="viewport" content="height=device-height, width=device-width, initial-scale=1.0, minimum-scale=0.5, maximum-scale=2.0">
    <meta name="description" content="Um mapa de referência para acordeons diatônicos">
    <meta name="author" content="Flávio Luiz Vani">

    <!-- Estilos para a página e popups -->
    <link href="css/bootstrap.min.css" rel="stylesheet">
    <link href="css/gaitas.css" rel="stylesheet">

  </head>
  <body>
   
    <div class="navbar navbar-inverse navbar-fixed-top">
      <div style="background-color:#5ba4a4;">
        <div class="container">
			   <header>
          <table><tr>
            <td><h1>Mapa para <span>Acordeons Diatônicos</span></h1></td>
            <td style="width:5%;"></td>
            <td><a class="brand" href="#openModal">Sobre</a></td>
          </tr></table>
			   </header>
        </div>
      </div>
    </div>
   
    <div class="container" >
      <div class="span12" style="height:65px;">
        <table><tr><td>
            <table class="table table-bordered table-final">
              <tr >
                <td >
                  <div class="btn-group">
                    <button class="btn label dropdown-toggle" data-toggle="dropdown">Acordeons&nbsp;&nbsp;&nbsp;<span class="caret"></span></button>
                    <ul class="dropdown-menu" id="opcoes_gaita"></ul>
                  </div>
                </td >
                <td >
                  <div class="btn-group">
                    <button class="btn label dropdown-toggle" data-toggle="dropdown">Afinações&nbsp;&nbsp;&nbsp;<span class="caret"></span></button>
                    <ul class="dropdown-menu" id="opcoes_afinacao"></ul>
                  </div>
                </td >
                <td >
                  <button id="sub_half_tone" class="btn label" title="reduzir meio tom"><i class="icon-circle-arrow-down icon-white"></i>&nbsp;&frac12;&nbsp;tom</button>
                  <button id="add_half_tone" class="btn label" title="aumentar meio tom"><i class="icon-circle-arrow-up icon-white"></i>&nbsp;&frac12;&nbsp;tom</button>
                </td >
                <td >
                  <button id="change_labels" class="btn label"><i class="icon-globe icon-white"></i>&nbsp;Trocar Símbolos</button>
                </td >
              </tr>
              <tr > 
                <td colspan="2" >
                    &nbsp;<b>MIDI:</b>&nbsp;<a style="padding: 5px; float:top;" ></a>
                    <input type="checkbox" id="checkboxAcordeon" checked >&nbsp;Acordeon&nbsp;&nbsp;&nbsp;&nbsp;
                    <input type="checkbox" id="checkboxPiano">&nbsp;Piano
                </td>
                <td colspan="2" style="height:22px;">
                    &nbsp;<b>Layout:</b>&nbsp;<a style="padding: 5px; float:top;" ></a>
                    <input type="checkbox" id="checkboxHorizontal" checked >&nbsp;Horizontal&nbsp;&nbsp;&nbsp;&nbsp;
                    <input type="checkbox" id="checkboxEspelho">&nbsp;Espelho
                </td >
              </tr>
            </table>
           </td><td style="padding: 1%"></td><td>
            </td></tr>
          </table>
        </div>

      <div id="div_principal" class="span12" style="margin-top:12px; margin-left:20px;" >
        <ul id="faketab">
            <li><a href="#" name="nomeGaita" id="a_nome_gaita">Gaita</a></li>
        </ul>
        <div id="content"> 
          <div id="keyboard" onmouseover="stopPlaying();" style="width: 700px; float: left;" ></div>
          <div id="div_info" style=" float: right; margin-top: 30px; margin-right: 5px;">
            <table class="table table-bordered table-final">
              <tr>
                <td colspan="4" style="height:220px;" id="div_imagem_gaita" >
                    <b>Loading...<b/>
                </td>
              </tr>
              <tr>
                <td style="vertical-align: middle;">&nbsp;Afinação Atual</td>
                <td style="width: 95px;">&nbsp;<span class="label" id="afinacao">?/?</span></td>
              </tr>
              <tr>
                <td style="vertical-align: middle;">&nbsp;Acorde Atual</td>
                <td>
                  &nbsp;<span class="label" id="acordeAtualVazio">--
                  </span>
                  <span class="label label-success" id="acordeAtualFoleAbrindo" style="display: none" >--&nbsp;
                     <i id="abre_fole" class="icon-resize-full icon-white"></i>
                  </span>
                  <span class="label label-warning" id="acordeAtualFoleFechando" style="display: none" >--&nbsp;
                      <i id="fecha_fole" class="icon-resize-small icon-white"></i>
                  </span>
                </td>
              </tr>
            </table>
          </div>
        </div>
      </div>
      
      <div id="div_detalhes" class="span12" style="margin-top:10px; margin-left:20px;" > 
        <ul id="tabs">
            <li><a href="#" name="tabAcordes">Acordes</a></li>
            <li><a href="#" name="tabBaixos">Baixos</a></li>
            <li><a href="#" name="tabEscalas">Escalas</a></li>
        </ul>
        <div id="content_detalhes" > 
            <div id="tabAcordes" >
              <table id="chords_table" class="table table-striped">
              </table>
            </div>
            <div  id="tabBaixos" >
              <table id="baixos_table" class="table table-striped">
              </table>
            </div>
            <div  id="tabEscalas" >
              <table id="scales_table" class="table table-striped">
              </table>
            </div>
        </div>
      </div>

    </div> <!-- /container -->

    <div id="openModal" class="modalWindow">
      <div>
        
        <div class="modalHeader">
          <h2>Sobre...</h2>
          <a href="#close" title="Fechar" class="close">X</a>
        </div>
        
        <div class="modalContent">
   <div id="clustrmaps-widget" style="float:right;   margin-left:1em;"></div><script type="text/javascript">
	   var _clustrmaps = {'url' : 'http://flvani.github.io', 'user' : 1132824, 
	   'server' : '2', 'id' : 'clustrmaps-widget', 'version' : 1, 'date' : '2014-02-19', 'lang' : 'pt', 
	   'corners' : 'square' };(function (){ var s = document.createElement('script'); 
	   s.type = 'text/javascript'; s.async = true; s.src = 'http://www2.clustrmaps.com/counter/map.js';
	    var x = document.getElementsByTagName('script')[0]; x.parentNode.insertBefore(s, x);})();</script>
	    <noscript><a href="http://www2.clustrmaps.com/user/617114918">
			<img src="http://www2.clustrmaps.com/stats/maps-no_clusters/flvani.github.io-thumb.jpg" alt="Localização dos visitantes desta página.	" />
			</a></noscript>
          <h3>Diatonic-Map <i>v0.9</i><br><span>Desenvolvido por <a href="mailto:flavio.vani@gmail.com"><strong>Flávio Vani</strong></a></span> </h3>
          <p>Este projeto pretende ser um mapa de referência para acordeons diatônicos. É possível configurar e mostrar o layout, de qualquer gaita de botões, nos seus mais diversos modelos. Através da implementação das bibliotecas de MIDI para browsers, tornou-se possível ouvir acordes (inclusive dos baixos) e executar escalas. O objetivo final é proporcionar uma experiência visual e interativa para aqueles que estão iniciando seus estudos na "Gaita Ponto".
          
          <p>Meus especiais agradecimentos ao <a href="http://www.youtube.com/watch?v=6_moobqpyyY"><strong>Prof. Cezar Ferreira</strong></a>, 
              que forneceu o material necessário para criação dos layouts e mapeamento dos acordes.
          <p>
          <h5>E muitos agradecimentos aos autores destas bibliotecas:</h5>
          <ul>
            <li><a href="https://github.com/leandron/accordion-map" target="_blank">accordion-map</a> by Leandro Nunes: An interactive reference map for diatonic accordion chords (in portuguese).
            </li>
            <li><a href="https://github.com/mudcube/MIDI.js" target="_blank">MIDI.js</a> by Michael Deal: Making life easy to create a MIDI-app on the web. Includes a library that convert soundfonts for Accordion, Piano, Guitar, Bass, Drums, ect. into code that can be read by the browser, thus, bringing MIDI generation to the browser.
            </li>
            <li><a href="https://github.com/gleitz/midi-js-soundfonts" target="_blank">midi-js-soundfonts</a> by Benjamin Gleitzman: Pre-rendered General MIDI soundfonts that can be used immediately with "MIDI.js".
            </li>
            <li><a href="https://github.com/gasman/jasmid" target="_blank">jasmid</a> by Matt Westcott: Reads MIDI file byte-code, and translates into a Javascript array.
            </li>
            <li><a href="http://blog.danguer.com/2011/10/24/base64-binary-decoding-in-javascript" target="_blank">base642binary.js</a> by Daniel Guerrero: Cleans up XML base64-requests for Web Audio API.
            </li>
            <li><a href="http://www.schillmania.com/projects/soundmanager2" target="_blank">SoundManager 2</a> by Scott Schiller: A JavaScript Sound API supporting MP3, MPEG4 and HTML5 Audio.
            </li>
            <li><a href="http://webaudio.github.io/web-midi-api/" target="_blank">Web MIDI API</a>: W3C proposal by Jussi Kalliokoski &amp; Chris Wilson.
            </li>
            <li><a href="https://dvcs.w3.org/hg/audio/raw-file/tip/webaudio/specification.html" target="_blank">Web Audio API</a>: W3C proposal by Chris Rogers.
            </li>
            <li><a href="http://dev.w3.org/html5/spec/Overview.html" target="_blank">Tag &lt;audio&gt;</a>: W3C HTML 5.1 Nightly A vocabulary and associated APIs for HTML and XHTML.
            </li>
          </ul>
        </div>


        
        <div class="modalFooter">
          Esta obra é distribuida sob uma Licença <b rel="license" href="http://creativecommons.org/licenses/by/3.0/br/deed.pt_BR">
			   Creative Commons Atribuição 3.0 Brasil</b>.
          <a href="#cancel" title="Fechar a janela" class="cancel">Fechar</a>
          <a href="http://creativecommons.org/licenses/by/3.0/br/deed.pt_BR" target="_blank" title="Ver a licença" class="ok">Ver</a>
          <div class="clear"></div>
        </div>

      </div>
    </div>


    <!-- suporte a MIDI -->
    <script type="text/javascript" src="MIDI.js/js/MIDI/AudioDetect.js"></script>
    <script type="text/javascript" src="MIDI.js/js/MIDI/LoadPlugin.js"></script>
    <script type="text/javascript" src="MIDI.js/js/MIDI/Plugin.js"></script>
    <script type="text/javascript" src="MIDI.js/js/MIDI/Player.js"></script>
    <script type="text/javascript" src="MIDI.js/js/Window/DOMLoader.XMLHttp.js"></script>
    <script type="text/javascript" src="MIDI.js/js/Window/DOMLoader.script.js"></script>
    <script type="text/javascript" src="MIDI.js/inc/Base64.js"></script>
    <script type="text/javascript" src="MIDI.js/inc/base64binary.js"></script>

    <!-- suporte aos mapas de teclados -->
    <script type="text/javascript" src="js/jquery.min.js"></script>
    <script type="text/javascript" src="js/bootstrap-dropdown.js"></script>
    <script type="text/javascript" src="js/kinetic-v5.0.0.min.js"></script>
    <script type="text/javascript" src="js/setup-gaita.js"></script>
    <script type="text/javascript" src="js/funcoes.js"></script>

    <!-- modelos de gaitas disponíveis -->
    <script type="text/javascript" src="gaitas/gaita.hohner.gc.js"></script>
    <script type="text/javascript" src="gaitas/gaita.hohner.clubIIIM.js"></script>
    <script type="text/javascript" src="gaitas/gaita.hohner.clubIIIM.br.js"></script>
    <script type="text/javascript" src="gaitas/gaita.hohner.coronaII.js"></script>

    <script type="text/javascript">
      
      // GLOBAIS
      var gStage;
      var gLayer;
      var gTimeout;
      var gIntervalo=256;
      var gShowLabel=false;
      var gCurrentToneOffset=0;
      var checkboxEspelho = document.getElementById('checkboxEspelho');
      var checkboxHorizontal = document.getElementById('checkboxHorizontal');

      ﻿// CONSTANTES
      c_close=0;
      c_open=1;
      c_label=0;
      c_oitava=1;

      // teclado
      c_keys=0;
      c_bass=1;
      c_Xpos=2;

      // acordeon
      c_nome=0;
      c_afinacao=1;
      c_pedal=2;
      c_teclado=3;
      c_acordes=4;
      c_escalas=5;
      c_imagem=6;

      // acordes e escalas
      c_symbol=0;
      c_variations=1;
      c_notas=1;

      // aspectos do botão
      c_btnSize=56;
      c_btnSpace=3;
      c_fontSize=18; // razoavel ser menor que metade do btnSize

      if (typeof (GAITA) === "undefined") var GAITA = {};

      GAITA.keyToNote       = {}; // C8  == 108
      GAITA.noteToKey       = {}; // 108 ==  C8
      GAITA.minNote         = 0x15; //  A0 = first note
      GAITA.maxNote         = 0x6C; //  C8 = last note
      GAITA.number2key      = ["C", "C♯", "D", "E♭", "E", "F", "F♯", "G", "G♯", "A", "B♭", "B"]
      GAITA.number2keyflat  = ["C", "D♭", "D", "D♯", "E", "F", "G♭", "G", "A♭", "A", "A♯", "B"];
      GAITA.number2key_br   = ["Dó", "Dó♯", "Ré", "Mi♭", "Mi", "Fá", "Fá♯", "Sol", "Sol♯", "Lá", "Si♭", "Si"]
      GAITA.afinacoesComuns = [ ["C","F"], ["G","C"], ["A","D"], ["A","D","G"] ];
      GAITA.minNoteInUse    = GAITA.maxNote;
      GAITA.maxNoteInUse    = GAITA.minNote;
      GAITA.gaitas          = [GAITA_HOHNER_GC, GAITA_CLUB_BR, GAITA_HOHNER_CORONA];
      GAITA.selected        = 0;
      GAITA.selectedChord   = -1;
      GAITA.keyboard        = {};
      GAITA.modifiedItems   = {};
      GAITA.sounding        = false;

      // popular arrays com nomes e valores de notas
      (function() { "use strict";
        for (var n = GAITA.minNote; n <= GAITA.maxNote; n++) {
          var octave = (n - 12) / 12 >> 0;
          var name = GAITA.number2key[n % 12] + octave;
          GAITA.noteToKey[n] = name;
          GAITA.keyToNote[name] = n;
          name = GAITA.number2keyflat[n % 12] + octave;
          GAITA.keyToNote[name] = n;
        }})();

      $('#change_labels').on('click', function () {
        gShowLabel = !gShowLabel;
        redrawKeyboard();
      });

      $('#sub_half_tone').on('click', function () {
        if ( gCurrentToneOffset + GAITA.minNoteInUse > GAITA.minNote ) {
          --gCurrentToneOffset;
          redrawKeyboard();
        } else {
          alert( "Limite mínimo atingido!" );
        }
      });

      $('#add_half_tone').on('click', function () {
        if ( gCurrentToneOffset + GAITA.maxNoteInUse < GAITA.maxNote ) {
          ++gCurrentToneOffset;
          redrawKeyboard();
        } else {
          alert( "Limite máximo atingido!" );
        }
      });

      checkboxHorizontal.addEventListener('click', function() {
         setupGaita( GAITA.selected );
      }, false );

      checkboxEspelho.addEventListener('click', function() {
         setupGaita( GAITA.selected );
      }, false );

      window.onload = function() {
        MIDI.loadPlugin({
          targetFormat: "mp3", 
          soundfontUrl: "MIDI.js/soundfont/",
          //instrument:  "accordion",
          //instrument:  "acoustic_grand_piano",
          instruments:  ["accordion", "acoustic_grand_piano" ],
          callback: function() {
            MIDI.programChange( 0, 21 ); // accordion
            //MIDI.programChange( 0,  0 ); // piano
            MIDI.programChange( 1,  0 ); // piano
          }
        });

        // populas listas drop-down        
        carregaListaGaitas();
        carregaListaAfinacoesComuns();

        // configura e mostra a gaita inicial
        setupGaita( GAITA.selected );

      }

$(document).ready(function() {
    $("#content_detalhes").find("[id^='tab']").hide(); // Hide all content
    $("#tabs li:first").attr("id","current"); // Activate the first tab
    $("#content_detalhes #tabAcordes").fadeIn(); // Show first tab's content
    
    $('#tabs a').click(function(e) {
        e.preventDefault();
        if ($(this).closest("li").attr("id") == "current"){ //detection for current tab
         return;       
        }
        else{             
          $("#content_detalhes").find("[id^='tab']").hide(); // Hide all content
          $("#tabs li").attr("id",""); //Reset id's
          $(this).parent().attr("id","current"); // Activate this
          $('#' + $(this).attr('name')).fadeIn(); // Show content for the current tab
        }
    });
});

    </script>
  </body>
</html>
